{
  "id": "sql-query-evaluation-root",
  "requirements": "SQL Query Evaluation",
  "sequential": false,
  "sub_tasks": [
    {
      "id": "patient-cohort-construction",
      "requirements": "Patient Cohort Construction: Filters for the correct patient demographic and initial condition.",
      "weight": 3,
      "sequential": false,
      "sub_tasks": [
        {
          "id": "gender-selection",
          "requirements": "Gender Selection: The query must filter for male patients using `p.gender = 'M'`.",
          "sequential": false,
          "critical": true,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "age-range-selection",
          "requirements": "Age Range Selection: The query must filter patients aged between 46 and 56 using `p.anchor_age BETWEEN 46 AND 56`.",
          "sequential": false,
          "critical": true,
          "scoring": "1/0",
          "sub_tasks": []
        }
      ]
    },
    {
      "id": "medical-concept-implementation",
      "requirements": "Medical Concept Implementation: Identifies stroke-related admissions and filters for the first admission.",
      "weight": 2,
      "sequential": true,
      "sub_tasks": [
        {
          "id": "stroke-diagnosis-identification",
          "requirements": "Stroke Diagnosis Identification: The query must correctly identify stroke admissions by filtering on both ICD-9 codes ('430'-'437') and ICD-10 codes ('I60'-'I69').",
          "sequential": false,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "first-admission-logic",
          "requirements": "First Admission Logic: The query must use a window function like `ROW_NUMBER() OVER(PARTITION BY p.subject_id ORDER BY a.admittime ASC)` and filter for the result equal to 1 to isolate each patient's first stroke-related admission.",
          "sequential": false,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": []
        }
      ]
    },
    {
      "id": "database-integration",
      "requirements": "Database Integration: Correctly joins necessary tables to link patient demographics, admissions, diagnoses, and ICU stay information.",
      "weight": 3,
      "sequential": false,
      "sub_tasks": [
        {
          "id": "core-table-joins",
          "requirements": "Core Table Joins: The query must correctly join `patients`, `admissions`, `diagnoses_icd` (via a CTE), and `icustays` tables.",
          "sequential": false,
          "critical": true,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "key-matching",
          "requirements": "Key Matching: The query must use `subject_id` to link `patients` and `admissions`, and `hadm_id` to link `admissions`, `diagnoses_icd`, and `icustays`.",
          "sequential": false,
          "critical": true,
          "scoring": "1/0",
          "sub_tasks": []
        }
      ]
    },
    {
      "id": "clinical-analytics",
      "requirements": "Clinical Analytics: Calculates the Interquartile Range (IQR) of ICU Length of Stay (LOS).",
      "weight": 2,
      "sequential": true,
      "sub_tasks": [
        {
          "id": "icu-los-aggregation",
          "requirements": "ICU LOS Aggregation: The query must calculate the total ICU LOS per admission, for instance by using `SUM(icu.los)` grouped by admission.",
          "sequential": false,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "valid-los-filter",
          "requirements": "Valid LOS Filter: The query must filter out null or non-positive ICU LOS values (e.g., `icu.los IS NOT NULL AND icu.los > 0`) to ensure data quality.",
          "sequential": false,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "iqr-calculation",
          "requirements": "IQR Calculation: The query must correctly calculate the IQR using a function like `APPROX_QUANTILES` to find the difference between the 3rd and 1st quartiles.",
          "sequential": false,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": []
        }
      ]
    }
  ]
}
