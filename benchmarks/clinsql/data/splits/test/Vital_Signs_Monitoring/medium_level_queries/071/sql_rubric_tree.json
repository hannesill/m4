{
  "id": "sql-query-evaluation-root",
  "requirements": "SQL Query Evaluation",
  "sequential": false,
  "sub_tasks": [
    {
      "id": "patient-cohort-construction",
      "requirements": "Patient Cohort Construction",
      "weight": 3,
      "sequential": false,
      "sub_tasks": [
        {
          "id": "gender-selection",
          "requirements": "Gender Selection: The query must filter for female patients using `p.gender = 'F'`.",
          "sequential": false,
          "critical": true,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "age-range-selection",
          "requirements": "Age Range Selection: The query must accurately calculate the patient's age at admission and filter for the range between 38 and 48 years.",
          "sequential": false,
          "critical": true,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "icu-stay-selection",
          "requirements": "ICU Stay Selection: The query must restrict the analysis to ICU stays by joining the `icustays` table.",
          "sequential": false,
          "critical": true,
          "scoring": "1/0",
          "sub_tasks": []
        }
      ]
    },
    {
      "id": "database-integration",
      "requirements": "Database Integration",
      "weight": 3,
      "sequential": true,
      "sub_tasks": [
        {
          "id": "cohort-table-joins",
          "requirements": "Cohort Table Joins: The query must correctly join `patients`, `admissions`, and `icustays` tables to build the initial patient cohort.",
          "sequential": false,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "chartevents-join",
          "requirements": "Chartevents Join: The query must join the patient cohort with the `chartevents` table on `stay_id` to link patients to their SpO2 measurements.",
          "sequential": false,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": []
        }
      ]
    },
    {
      "id": "medical-concept-implementation",
      "requirements": "Medical Concept Implementation",
      "weight": 2,
      "sequential": false,
      "sub_tasks": [
        {
          "id": "spo2-code-selection",
          "requirements": "SpO2 Code Selection: The query must filter `chartevents` for SpO2 measurements using the correct itemid, `ce.itemid = 220277`.",
          "sequential": false,
          "critical": true,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "spo2-value-validation",
          "requirements": "SpO2 Value Validation: The query should apply a plausible range filter (e.g., BETWEEN 50 AND 100) to `valuenum` to exclude erroneous SpO2 readings.",
          "sequential": false,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": []
        }
      ]
    },
    {
      "id": "clinical-analytics",
      "requirements": "Clinical Analytics",
      "weight": 2,
      "sequential": true,
      "sub_tasks": [
        {
          "id": "per-stay-aggregation",
          "requirements": "Per-Stay Aggregation: The query must calculate the mean SpO2 on a per-stay basis by grouping by `stay_id`.",
          "sequential": false,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "percentile-calculation",
          "requirements": "Percentile Calculation: The query must calculate the proportion of stays with a mean SpO2 of 92% or less, expressed as a percentage, to determine the percentile rank.",
          "sequential": false,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "safe-division-handling",
          "requirements": "Safe Division Handling: The query should use a function like SAFE_DIVIDE to prevent division-by-zero errors in the percentile calculation.",
          "sequential": false,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": []
        }
      ]
    }
  ]
}
