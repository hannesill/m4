{
  "id": "sql-query-evaluation-root",
  "requirements": "SQL Query Evaluation",
  "sequential": false,
  "sub_tasks": [
    {
      "id": "patient-cohort-construction",
      "requirements": "Patient Cohort Construction",
      "weight": 3,
      "sequential": false,
      "sub_tasks": [
        {
          "id": "gender-selection",
          "requirements": "Gender Selection: Filters the cohort to include only male patients using `p.gender = 'M'`.",
          "sequential": false,
          "critical": true,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "age-range-selection",
          "requirements": "Age Range Selection: Correctly calculates patient age at the time of admission and filters for the range 73-83 years using `(p.anchor_age + EXTRACT(YEAR FROM a.admittime) - p.anchor_year) BETWEEN 73 AND 83`.",
          "sequential": false,
          "critical": true,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "icu-stay-identification",
          "requirements": "ICU Stay Identification: Correctly identifies ICU stays for the cohort by joining with the `icustays` table.",
          "sequential": false,
          "critical": true,
          "scoring": "1/0",
          "sub_tasks": []
        }
      ]
    },
    {
      "id": "database-integration",
      "requirements": "Database Integration for Cohort and Measurements",
      "weight": 3,
      "sequential": true,
      "sub_tasks": [
        {
          "id": "cohort-table-joins",
          "requirements": "Cohort Table Joins: Correctly joins `patients`, `admissions`, and `icustays` tables to build the initial patient cohort.",
          "sequential": false,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "measurement-table-join",
          "requirements": "Measurement Table Join: Correctly joins the identified cohort with the `chartevents` table on `stay_id` to link patients to their SpO2 measurements.",
          "sequential": false,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": []
        }
      ]
    },
    {
      "id": "medical-concept-implementation",
      "requirements": "Medical Concept Implementation for SpO2",
      "weight": 2,
      "sequential": true,
      "sub_tasks": [
        {
          "id": "spo2-code-selection",
          "requirements": "SpO2 Code Selection: Correctly identifies SpO2 measurements by filtering `chartevents` using the appropriate item IDs `(220277, 646)`.",
          "sequential": false,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "value-plausibility-filter",
          "requirements": "Value Plausibility Filter: Applies a clinically reasonable filter to SpO2 values to exclude outliers and errors, such as `ce.valuenum BETWEEN 70 AND 100`.",
          "sequential": false,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": []
        }
      ]
    },
    {
      "id": "clinical-analytics",
      "requirements": "Clinical Analytics and Final Calculation",
      "weight": 2,
      "sequential": true,
      "sub_tasks": [
        {
          "id": "temporal-filter-24h",
          "requirements": "Temporal Filter (First 24 Hours): Correctly filters SpO2 measurements to include only those recorded within the first 24 hours of the ICU stay using `ce.charttime BETWEEN cp.intime AND DATETIME_ADD(cp.intime, INTERVAL 24 HOUR)`.",
          "sequential": false,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "per-stay-aggregation",
          "requirements": "Per-Stay Aggregation: Correctly calculates the average SpO2 for each individual ICU stay by grouping by `stay_id` and using `AVG(valuenum)`.",
          "sequential": false,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "percentile-calculation",
          "requirements": "Percentile Calculation: Correctly calculates the percentile rank for the target value of 92 by counting stays at or below the target and dividing by the total number of stays in the cohort.",
          "sequential": false,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": []
        }
      ]
    }
  ]
}
