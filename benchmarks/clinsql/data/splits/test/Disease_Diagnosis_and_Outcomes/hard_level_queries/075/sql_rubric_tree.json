{
  "id": "sql-query-evaluation-root",
  "requirements": "SQL Query Evaluation",
  "sequential": false,
  "sub_tasks": [
    {
      "id": "patient-cohort-construction",
      "requirements": "Patient Cohort Construction",
      "weight": 3,
      "sequential": false,
      "sub_tasks": [
        {
          "id": "gender-selection",
          "requirements": "Filters for female patients using `p.gender = 'F'`.",
          "sequential": false,
          "critical": true,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "age-range-selection",
          "requirements": "Correctly calculates patient age at admission and filters for the 44-54 range using `(p.anchor_age + DATETIME_DIFF(a.admittime, DATETIME(p.anchor_year, 1, 1, 0, 0, 0), YEAR)) BETWEEN 44 AND 54`.",
          "sequential": false,
          "critical": true,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "ich-cohort-filtering",
          "requirements": "Correctly filters for the intracranial hemorrhage cohort in the final aggregation using `WHERE is_ich_admission IS TRUE`.",
          "sequential": false,
          "critical": true,
          "scoring": "1/0",
          "sub_tasks": []
        }
      ]
    },
    {
      "id": "database-integration",
      "requirements": "Database Integration",
      "weight": 3,
      "sequential": true,
      "sub_tasks": [
        {
          "id": "patient-admission-join",
          "requirements": "Correctly joins `patients` and `admissions` tables on `subject_id` to link patient demographics with admission details.",
          "sequential": false,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "admission-diagnosis-join",
          "requirements": "Correctly performs a `LEFT JOIN` between the base patient cohort and the `diagnoses_flags` CTE on `hadm_id` to associate diagnoses without losing patients.",
          "sequential": false,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": []
        }
      ]
    },
    {
      "id": "medical-concept-implementation",
      "requirements": "Medical Concept Implementation",
      "weight": 3,
      "sequential": true,
      "sub_tasks": [
        {
          "id": "ich-code-identification",
          "requirements": "Identifies intracranial hemorrhage by correctly handling both ICD-9 ('430%', '431%', '432%') and ICD-10 ('I60%', 'I61%', 'I62%') codes.",
          "sequential": false,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "major-complication-code-identification",
          "requirements": "Identifies major complications by correctly handling both ICD-9 and ICD-10 codes based on the specified lists.",
          "sequential": false,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "mortality-90day-logic",
          "requirements": "Correctly calculates 90-day post-discharge mortality by checking if `dod` is within 90 days after `dischtime`.",
          "sequential": false,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "los-calculation",
          "requirements": "Calculates length of stay (LOS) in days and correctly handles potential negative or null values using `GREATEST` and `IFNULL`.",
          "sequential": false,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "risk-score-logic",
          "requirements": "Implements the custom risk score formula correctly, including base score, bonuses for ICH and complications, a factor for LOS, and a cap of 100.",
          "sequential": false,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": []
        }
      ]
    },
    {
      "id": "clinical-analytics",
      "requirements": "Clinical Analytics",
      "weight": 2,
      "sequential": true,
      "sub_tasks": [
        {
          "id": "dual-cohort-structure",
          "requirements": "Uses `UNION ALL` to generate two distinct result sets: one for the ICH cohort and one for the general comparison cohort.",
          "sequential": false,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "median-iqr-risk-score",
          "requirements": "Calculates the median and IQR of the risk score using `APPROX_QUANTILES`.",
          "sequential": false,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "mortality-rate",
          "requirements": "Calculates the 90-day mortality rate using `AVG()` on the binary `mortality_90day` flag.",
          "sequential": false,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "complication-rate",
          "requirements": "Calculates the major complication rate using `AVG(CAST(has_major_complication AS INT64))`.",
          "sequential": false,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "median-survivor-los",
          "requirements": "Calculates the median LOS for survivors by using a `CASE` statement within `APPROX_QUANTILES` to exclude deceased patients.",
          "sequential": false,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "risk-percentile-output",
          "requirements": "Correctly provides a textual explanation for the matched profile risk percentile for the ICH cohort and NULL for the general cohort.",
          "sequential": false,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": []
        }
      ]
    }
  ]
}
