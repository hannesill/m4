{
  "id": "sql-query-evaluation-root",
  "requirements": "SQL Query Evaluation",
  "sequential": false,
  "sub_tasks": [
    {
      "id": "patient-cohort-construction",
      "requirements": "Patient Cohort Construction",
      "weight": 3,
      "sequential": false,
      "sub_tasks": [
        {
          "id": "gender-selection",
          "requirements": "Gender Selection: The query must filter for female patients using the condition p.gender = 'F'.",
          "sequential": false,
          "critical": true,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "age-range-selection",
          "requirements": "Age Range Selection: The query must correctly calculate the patient's age at the time of admission and filter for the range 72-82, using a formula like (anchor_age + EXTRACT(YEAR FROM admittime) - anchor_year) BETWEEN 72 AND 82.",
          "sequential": false,
          "critical": true,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "insurance-filter",
          "requirements": "Insurance Filter: The query must filter for patients with 'Medicare' insurance via the condition insurance = 'Medicare'.",
          "sequential": false,
          "critical": true,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "admission-type-filter",
          "requirements": "Admission Type Filter: The query must filter for admissions originating from the emergency department using a condition like UPPER(admission_location) LIKE '%EMERGENCY%'.",
          "sequential": false,
          "critical": true,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "discharge-status-filter",
          "requirements": "Discharge Status Filter: The query must ensure that only discharged admissions are included by checking that the discharge time is not null (e.g., dischtime IS NOT NULL).",
          "sequential": false,
          "critical": true,
          "scoring": "1/0",
          "sub_tasks": []
        }
      ]
    },
    {
      "id": "medical-concept-implementation",
      "requirements": "Medical Concept Implementation",
      "weight": 2,
      "sequential": true,
      "sub_tasks": [
        {
          "id": "principal-diagnosis-filter",
          "requirements": "Principal Diagnosis Filter: The query must correctly identify the principal diagnosis by filtering on seq_num = 1 in the diagnoses_icd table.",
          "sequential": false,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "icd-version-handling",
          "requirements": "ICD Version Handling: The query must correctly handle both ICD-9 and ICD-10 codes by checking the icd_version column.",
          "sequential": false,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "acute-pancreatitis-code-selection",
          "requirements": "Acute Pancreatitis Code Selection: The query must accurately select codes for acute pancreatitis across both ICD versions (ICD-9: '5770', ICD-10: 'K85%').",
          "sequential": false,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": []
        }
      ]
    },
    {
      "id": "database-integration",
      "requirements": "Database Integration",
      "weight": 3,
      "sequential": false,
      "sub_tasks": [
        {
          "id": "table-join-logic",
          "requirements": "Table Join Logic: The query must correctly join the admissions, patients, and diagnoses_icd tables to link patient demographics with their admission and diagnosis details.",
          "sequential": false,
          "critical": true,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "key-matching",
          "requirements": "Key Matching: The query must use the correct keys for joining tables: subject_id for admissions to patients, and hadm_id for admissions to diagnoses_icd.",
          "sequential": false,
          "critical": true,
          "scoring": "1/0",
          "sub_tasks": []
        }
      ]
    },
    {
      "id": "clinical-analytics",
      "requirements": "Clinical Analytics",
      "weight": 2,
      "sequential": false,
      "sub_tasks": [
        {
          "id": "final-aggregation",
          "requirements": "Final Aggregation: The query must correctly count the total number of admissions in the final cohort using COUNT(hadm_id).",
          "sequential": false,
          "critical": true,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "extraneous-calculations-check",
          "requirements": "Extraneous Calculations Check: The query includes calculations beyond the primary question (e.g., readmission rate, LOS). While not incorrect, the primary output must be the total admission count. This node checks if the main question is answered despite additional analytics.",
          "sequential": false,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": []
        }
      ]
    }
  ]
}
