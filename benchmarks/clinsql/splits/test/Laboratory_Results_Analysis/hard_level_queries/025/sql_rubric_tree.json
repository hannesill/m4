{
  "id": "sql-query-evaluation-root",
  "requirements": "SQL Query Evaluation for Hemorrhagic Stroke Lab Instability Analysis",
  "sequential": false,
  "sub_tasks": [
    {
      "id": "patient-cohort-construction",
      "requirements": "Patient Cohort Construction",
      "weight": 3,
      "sequential": true,
      "sub_tasks": [
        {
          "id": "base-cohort-selection",
          "requirements": "Base Cohort Selection: Correctly selects female patients aged 48-58 from the admissions and patients tables.",
          "sequential": true,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": [
            {
              "id": "gender-selection",
              "requirements": "Gender Filter: Filters for female patients using `p.gender = 'F'`.",
              "sequential": false,
              "critical": true,
              "scoring": "1/0",
              "sub_tasks": []
            },
            {
              "id": "age-range-selection",
              "requirements": "Age Filter: Correctly calculates patient age at admission and filters for the range 48-58.",
              "sequential": false,
              "critical": true,
              "scoring": "1/0",
              "sub_tasks": []
            }
          ]
        },
        {
          "id": "hemorrhagic-stroke-identification",
          "requirements": "Hemorrhagic Stroke Identification: Correctly identifies hospital admissions with a diagnosis of hemorrhagic stroke using both ICD-9 and ICD-10 codes.",
          "sequential": true,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": [
            {
              "id": "icd-version-handling",
              "requirements": "ICD Version Handling: The query must correctly distinguish and handle both ICD-9 and ICD-10 codes using `dx.icd_version`.",
              "sequential": false,
              "critical": true,
              "scoring": "1/0",
              "sub_tasks": []
            },
            {
              "id": "stroke-code-selection",
              "requirements": "Stroke Code Selection: Uses appropriate LIKE patterns for both ICD-9 (e.g., '430%', '431%') and ICD-10 (e.g., 'I60%', 'I61%') to identify hemorrhagic stroke.",
              "sequential": false,
              "critical": true,
              "scoring": "1/0",
              "sub_tasks": []
            }
          ]
        },
        {
          "id": "comparison-cohort-creation",
          "requirements": "Comparison Cohort Creation: Creates a comparison cohort of age- and gender-matched patients who do not have a hemorrhagic stroke diagnosis.",
          "sequential": false,
          "critical": true,
          "scoring": "1/0",
          "sub_tasks": []
        }
      ]
    },
    {
      "id": "clinical-analytics",
      "requirements": "Clinical Analytics and Calculations",
      "weight": 3,
      "sequential": true,
      "sub_tasks": [
        {
          "id": "lab-instability-score-calculation",
          "requirements": "Lab Instability Score Calculation: Correctly calculates the lab instability score for the stroke cohort based on the number of unique lab systems with critical values within the first 72 hours.",
          "sequential": true,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": [
            {
              "id": "lab-definitions",
              "requirements": "Lab Definitions: A CTE or similar structure correctly defines a set of relevant lab tests and their critical value thresholds.",
              "sequential": false,
              "critical": true,
              "scoring": "1/0",
              "sub_tasks": []
            },
            {
              "id": "temporal-constraint-labs",
              "requirements": "Temporal Constraint for Labs: Filters lab events to the first 72 hours post-admission.",
              "sequential": false,
              "critical": true,
              "scoring": "1/0",
              "sub_tasks": []
            },
            {
              "id": "critical-value-logic",
              "requirements": "Critical Value Logic: Correctly identifies lab values as critical if they fall outside the defined low/high thresholds.",
              "sequential": false,
              "critical": true,
              "scoring": "1/0",
              "sub_tasks": []
            },
            {
              "id": "instability-score-aggregation",
              "requirements": "Instability Score Aggregation: Correctly counts the distinct number of lab systems with at least one critical value per patient (`COUNT(DISTINCT label)`).",
              "sequential": false,
              "critical": true,
              "scoring": "1/0",
              "sub_tasks": []
            }
          ]
        },
        {
          "id": "percentile-and-tiering",
          "requirements": "Percentile Calculation and Patient Tiering: Calculates the 90th percentile of the instability score and identifies the top-tier patient group.",
          "sequential": true,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": [
            {
              "id": "percentile-calculation",
              "requirements": "90th Percentile Calculation: Uses `PERCENTILE_CONT` or a similar window function to determine the 90th percentile of the instability score.",
              "sequential": false,
              "critical": true,
              "scoring": "1/0",
              "sub_tasks": []
            },
            {
              "id": "top-tier-identification",
              "requirements": "Top-Tier Patient Identification: Correctly filters for patients with an instability score greater than or equal to the calculated P90 value.",
              "sequential": false,
              "critical": true,
              "scoring": "1/0",
              "sub_tasks": []
            }
          ]
        },
        {
          "id": "outcome-metrics-calculation",
          "requirements": "Outcome Metrics Calculation: Correctly computes the required outcome metrics for the top-tier and comparison cohorts.",
          "sequential": true,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": [
            {
              "id": "mortality-rate",
              "requirements": "Mortality Rate: Calculates the mortality percentage for the top-tier stroke cohort using `AVG(hospital_expire_flag) * 100`.",
              "sequential": false,
              "critical": true,
              "scoring": "1/0",
              "sub_tasks": []
            },
            {
              "id": "mean-los",
              "requirements": "Mean Length of Stay (LOS): Calculates the average LOS for the top-tier stroke cohort.",
              "sequential": false,
              "critical": true,
              "scoring": "1/0",
              "sub_tasks": []
            },
            {
              "id": "avg-critical-labs",
              "requirements": "Average Critical Labs Per Patient: Correctly calculates the average number of critical lab events per patient for both the top-tier stroke group and the age-matched comparison cohort.",
              "sequential": false,
              "critical": true,
              "scoring": "1/0",
              "sub_tasks": []
            }
          ]
        }
      ]
    },
    {
      "id": "database-integration",
      "requirements": "Database Integration and Structure",
      "weight": 2,
      "sequential": false,
      "sub_tasks": [
        {
          "id": "table-join-logic",
          "requirements": "Table Join Logic: Correctly joins `patients`, `admissions`, `diagnoses_icd`, and `labevents` tables using appropriate keys (`subject_id`, `hadm_id`).",
          "sequential": false,
          "critical": true,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "cte-structure",
          "requirements": "CTE Structure: Uses Common Table Expressions (CTEs) effectively to modularize the query into logical, readable steps.",
          "sequential": false,
          "critical": false,
          "scoring": "1/0",
          "weight": 1,
          "sub_tasks": []
        }
      ]
    },
    {
      "id": "final-output-formatting",
      "requirements": "Final Output Formatting",
      "weight": 1,
      "sequential": false,
      "sub_tasks": [
        {
          "id": "column-selection",
          "requirements": "Final Column Selection: The final SELECT statement presents all the required metrics: P90 score, mortality, mean LOS, and the average critical labs for both the top-tier and comparison cohorts.",
          "sequential": false,
          "critical": true,
          "scoring": "1/0",
          "sub_tasks": []
        }
      ]
    }
  ]
}
