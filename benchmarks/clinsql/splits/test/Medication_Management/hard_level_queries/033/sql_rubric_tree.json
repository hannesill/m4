{
  "id": "sql-query-evaluation-root",
  "requirements": "SQL Query Evaluation",
  "sequential": false,
  "sub_tasks": [
    {
      "id": "patient-cohort-construction",
      "requirements": "Patient Cohort Construction",
      "weight": 3,
      "sequential": false,
      "sub_tasks": [
        {
          "id": "gender-selection",
          "requirements": "Gender Selection: Correctly filters for male patients using `pat.gender = 'M'`.",
          "sequential": false,
          "critical": true,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "age-range-selection",
          "requirements": "Age Range Selection: Correctly calculates age at admission and filters for patients between 80 and 90 years old.",
          "sequential": false,
          "critical": true,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "sepsis-diagnosis-selection",
          "requirements": "Sepsis Diagnosis Selection: Filters for sepsis using a comprehensive list of both ICD-9 and ICD-10 codes ('99591', '99592', '78552', 'A41%', 'R652%').",
          "sequential": false,
          "critical": true,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "inpatient-selection",
          "requirements": "Inpatient Selection: Implicitly selects inpatients by joining with the `admissions` table, which contains only inpatient stays.",
          "sequential": false,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": []
        }
      ]
    },
    {
      "id": "medical-concept-implementation",
      "requirements": "Medical Concept Implementation",
      "weight": 2,
      "sequential": true,
      "sub_tasks": [
        {
          "id": "medication-time-window",
          "requirements": "Medication Time Window: Correctly filters prescriptions to the first 24 hours after admission using `pr.starttime BETWEEN sc.admittime AND DATETIME_ADD(sc.admittime, INTERVAL 24 HOUR)`.",
          "sequential": false,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "medication-complexity-score",
          "requirements": "Medication Complexity Score: Accurately calculates the medication complexity score as the count of distinct drugs per hospital admission (`COUNT(DISTINCT drug)`).",
          "sequential": false,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "qt-prolonging-drug-identification",
          "requirements": "QT-Prolonging Drug Identification: Correctly identifies patients on QT-prolonging drugs using `COUNTIF` with a list of relevant drug names.",
          "sequential": false,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "bleeding-risk-drug-identification",
          "requirements": "Bleeding Risk Drug Identification: Correctly identifies patients on bleeding-risk drugs using `COUNTIF` with a list of relevant drug names.",
          "sequential": false,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": []
        }
      ]
    },
    {
      "id": "clinical-analytics",
      "requirements": "Clinical Analytics and Final Output",
      "weight": 3,
      "sequential": false,
      "sub_tasks": [
        {
          "id": "interaction-group-creation",
          "requirements": "Interaction Group Creation: Correctly categorizes patients into 'QT_and_Bleeding_Risk' and 'Matched_Cohort' based on their medication profile.",
          "sequential": false,
          "critical": true,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "percentile-rank-calculation",
          "requirements": "Percentile Rank Calculation: Correctly calculates the percentile rank of medication complexity using `PERCENT_RANK() OVER (ORDER BY pms.med_complexity_score)`.",
          "sequential": false,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "quartile-calculation",
          "requirements": "Quartile Calculation: Correctly assigns patients to medication complexity quartiles using `NTILE(4) OVER (ORDER BY pms.med_complexity_score)`.",
          "sequential": false,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "los-and-mortality-calculation",
          "requirements": "LOS and Mortality Calculation: Correctly computes Length of Stay (LOS) from admission/discharge times and mortality from the `hospital_expire_flag`.",
          "sequential": false,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "final-aggregation-by-group",
          "requirements": "Final Aggregation by Group: Correctly groups the final results by the interaction group to provide summary statistics for each cohort.",
          "sequential": false,
          "critical": true,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "top-quartile-outcome-analysis",
          "requirements": "Top Quartile Outcome Analysis: Correctly calculates average LOS and mortality specifically for patients in the top quartile of medication complexity using conditional aggregation.",
          "sequential": false,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": []
        }
      ]
    },
    {
      "id": "database-integration",
      "requirements": "Database Integration and Structure",
      "weight": 1,
      "sequential": false,
      "sub_tasks": [
        {
          "id": "table-join-logic",
          "requirements": "Table Join Logic: Correctly joins patients, admissions, diagnoses_icd, and prescriptions tables using appropriate keys (subject_id, hadm_id).",
          "sequential": false,
          "critical": true,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "cte-structure",
          "requirements": "CTE Structure: Uses Common Table Expressions (CTEs) effectively to structure the query logically, breaking down the problem into sequential steps.",
          "sequential": false,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": []
        }
      ]
    }
  ]
}
