{
  "id": "sql-query-evaluation-root",
  "requirements": "SQL Query Evaluation",
  "sequential": false,
  "sub_tasks": [
    {
      "id": "patient-cohort-construction",
      "requirements": "Patient Cohort Construction: Defines the primary patient group for analysis based on demographic, clinical, and risk criteria.",
      "weight": 3,
      "sequential": false,
      "sub_tasks": [
        {
          "id": "gender-selection",
          "requirements": "Gender Selection: The query correctly filters for male patients using `gender = 'M'` in the `high_comorbidity_threshold` and `cohorts_identified` CTEs.",
          "sequential": false,
          "critical": true,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "age-range-selection",
          "requirements": "Age Range Selection: The query accurately filters for patients aged 81 to 91 using `age_at_admission BETWEEN 81 AND 91`.",
          "sequential": false,
          "critical": true,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "pe-condition-filter",
          "requirements": "Pulmonary Embolism Condition Filter: The query correctly identifies and filters for patients with a pulmonary embolism diagnosis using `has_pe = 1`.",
          "sequential": false,
          "critical": true,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "high-comorbidity-filter",
          "requirements": "High Comorbidity Filter: The query correctly applies a filter for high comorbidity by comparing `risk_score` against the calculated 75th percentile threshold.",
          "sequential": false,
          "critical": true,
          "scoring": "1/0",
          "sub_tasks": []
        }
      ]
    },
    {
      "id": "database-integration",
      "requirements": "Database Integration: Correctly joins and integrates data from multiple tables to create a unified dataset for analysis.",
      "weight": 3,
      "sequential": false,
      "sub_tasks": [
        {
          "id": "patient-admission-join",
          "requirements": "Patient and Admission Join: The query correctly joins the `patients` and `admissions` tables on `subject_id`.",
          "sequential": false,
          "critical": true,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "admission-diagnosis-join",
          "requirements": "Admission and Diagnosis Join: The query correctly joins the admission-level data with `diagnoses_icd` on `hadm_id`.",
          "sequential": false,
          "critical": true,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "age-calculation",
          "requirements": "Age Calculation: The query correctly calculates `age_at_admission` using `anchor_age`, `anchor_year`, and `admittime`.",
          "sequential": false,
          "critical": true,
          "scoring": "1/0",
          "sub_tasks": []
        }
      ]
    },
    {
      "id": "medical-concept-implementation",
      "requirements": "Medical Concept Implementation: Accurately translates clinical concepts like diseases, risk scores, and mortality into SQL logic.",
      "weight": 2,
      "sequential": true,
      "sub_tasks": [
        {
          "id": "pe-code-selection",
          "requirements": "PE Code Selection: The query correctly identifies pulmonary embolism using both ICD-9 ('4151%') and ICD-10 ('I26%') codes.",
          "sequential": false,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "aki-ards-code-selection",
          "requirements": "AKI/ARDS Code Selection: The query correctly flags AKI (ICD-9 '584%', ICD-10 'N17%') and ARDS (ICD-9 '51882', ICD-10 'J80').",
          "sequential": false,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "risk-score-calculation",
          "requirements": "Risk Score Calculation: The query implements a custom risk score formula: `(COUNT(DISTINCT icd_code) * 1) + (SUM(is_critical_illness_flag) * 5)`.",
          "sequential": false,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "mortality-90-day-logic",
          "requirements": "90-Day Mortality Logic: The query correctly calculates 90-day mortality using `hospital_expire_flag` and `DATETIME_DIFF` between `dod` and `dischtime`.",
          "sequential": false,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": []
        }
      ]
    },
    {
      "id": "clinical-analytics",
      "requirements": "Clinical Analytics: Performs the required calculations, comparisons, and aggregations to answer the clinical question.",
      "weight": 2,
      "sequential": true,
      "sub_tasks": [
        {
          "id": "comorbidity-threshold-calculation",
          "requirements": "Comorbidity Threshold Calculation: The query correctly calculates the 75th percentile risk score using `APPROX_QUANTILES` for the specified demographic.",
          "sequential": false,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "cohort-aggregation",
          "requirements": "Cohort Aggregation: The query correctly calculates mean risk score and 90-day mortality for the target cohort.",
          "sequential": false,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "comparison-logic",
          "requirements": "Comparison Logic: The query uses `UNION ALL` to create a comparison with the 'General_Inpatient_Population' and calculates corresponding metrics.",
          "sequential": false,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "survivor-los-calculation",
          "requirements": "Survivor LOS Calculation: The query correctly calculates the mean length of stay for survivors only, using `AVG(CASE WHEN is_90_day_mortality = 0 THEN los_days END)`.",
          "sequential": false,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "risk-percentile-calculation",
          "requirements": "Risk Percentile Calculation: The query correctly calculates the matched-profile risk percentile for the target cohort using `PERCENT_RANK()`.",
          "sequential": false,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": []
        }
      ]
    }
  ]
}
