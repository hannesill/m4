{
  "id": "sql-query-evaluation-root",
  "requirements": "SQL Query Evaluation",
  "sequential": false,
  "sub_tasks": [
    {
      "id": "patient-cohort-construction",
      "requirements": "Patient Cohort Construction",
      "weight": 3,
      "sequential": false,
      "sub_tasks": [
        {
          "id": "gender-selection",
          "requirements": "Gender Selection: The query must filter for male patients by using the condition `pat.gender = 'M'`.",
          "sequential": false,
          "critical": true,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "age-range-selection",
          "requirements": "Age Range Selection: The query must correctly calculate the age at admission and filter for patients between 88 and 98 years old, using a condition like `(pat.anchor_age + EXTRACT(YEAR FROM adm.admittime) - pat.anchor_year) BETWEEN 88 AND 98`.",
          "sequential": false,
          "critical": true,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "icu-stay-filter",
          "requirements": "ICU Stay Filter: The query must ensure that all patients in the cohort have at least one ICU stay, for example by using an `EXISTS` subquery on the `icustays` table linked by `hadm_id`.",
          "sequential": false,
          "critical": true,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "pneumonia-diagnosis-filter",
          "requirements": "Pneumonia Diagnosis Filter: The query must identify patients with pneumonia by checking for relevant ICD codes in both ICD-9 (e.g., `SUBSTR(icd_code, 1, 3) BETWEEN '480' AND '486'`) and ICD-10 (e.g., `SUBSTR(icd_code, 1, 3) BETWEEN 'J12' AND 'J18'`).",
          "sequential": false,
          "critical": true,
          "scoring": "1/0",
          "sub_tasks": []
        }
      ]
    },
    {
      "id": "database-integration",
      "requirements": "Database Integration",
      "weight": 3,
      "sequential": true,
      "sub_tasks": [
        {
          "id": "patient-demographics-join",
          "requirements": "Patient Demographics Join: The query must correctly join the `admissions` table with the `patients` table on `subject_id` to access demographic data like gender and anchor age.",
          "sequential": false,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "diagnosis-data-linkage",
          "requirements": "Diagnosis Data Linkage: The query must link the selected admissions (`hadm_id`) to the `diagnoses_icd` table to access diagnosis codes.",
          "sequential": false,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "cte-consolidation",
          "requirements": "CTE Consolidation: The query must correctly join the final calculated data CTE (`final_cohort_data`) back to the initial admissions CTE (`icu_admissions`) on `hadm_id` to integrate metrics with mortality and timing data.",
          "sequential": false,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": []
        }
      ]
    },
    {
      "id": "medical-concept-implementation",
      "requirements": "Medical Concept Implementation",
      "weight": 2,
      "sequential": false,
      "sub_tasks": [
        {
          "id": "composite-risk-score-logic",
          "requirements": "Composite Risk Score Logic: The query must implement the specified logic for the composite risk score using a `SUM` over a `CASE` statement that correctly maps ICD-9 and ICD-10 codes to their corresponding point values.",
          "sequential": false,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "aki-identification",
          "requirements": "AKI Identification: The query must create a flag for Acute Kidney Injury (AKI) by correctly identifying relevant ICD-9 (`LIKE '584%'`) and ICD-10 (`LIKE 'N17%'`) codes.",
          "sequential": false,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "ards-identification",
          "requirements": "ARDS Identification: The query must create a flag for Acute Respiratory Distress Syndrome (ARDS) by correctly identifying relevant ICD-9 (`'518.82', '518.5'`) and ICD-10 (`'J80'`) codes.",
          "sequential": false,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": []
        }
      ]
    },
    {
      "id": "clinical-analytics",
      "requirements": "Clinical Analytics",
      "weight": 2,
      "sequential": true,
      "sub_tasks": [
        {
          "id": "cohort-size-calculation",
          "requirements": "Cohort Size Calculation: The final query must report the total number of patients in the cohort using `COUNT(hadm_id)`.",
          "sequential": false,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "risk-score-distribution",
          "requirements": "Risk Score Distribution: The query must calculate the min, 25th, median, 75th, and max of the composite risk score using `MIN`, `MAX`, and `APPROX_QUANTILES`.",
          "sequential": false,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "outcome-rate-calculation",
          "requirements": "Outcome Rate Calculation: The query must correctly calculate the in-hospital mortality, AKI, and ARDS rates as percentages, typically using `AVG` on the corresponding flags and multiplying by 100.",
          "sequential": false,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": []
        },
        {
          "id": "median-survival-calculation",
          "requirements": "Median Survival Calculation: The query must calculate the survival days for deceased patients using `DATETIME_DIFF` between `deathtime` and `admittime` and then find the median of this value using `APPROX_QUANTILES`.",
          "sequential": false,
          "critical": false,
          "scoring": "1/0",
          "sub_tasks": []
        }
      ]
    }
  ]
}
